<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sudoku Solver</title>
  <style>
    table {
      border-collapse: collapse;
      margin: 20px auto;
    }
    td {
      border: 1px solid #444;
      width: 40px;
      height: 40px;
      text-align: center;
      padding: 0;
    }
    input {
      width: 90%;
      height: 90%;
      text-align: center;
      font-size: 18px;
      border: none;
      outline: none;
      background: transparent;
    }
    td:nth-child(3), td:nth-child(6) {
      border-right: 3px solid #000;
    }
    tr:nth-child(4) td, tr:nth-child(7) td {
      border-bottom: 3px solid #000;
    }
    button {
      display: block;
      margin: 20px auto;
      padding: 10px 20px;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <h1 style="text-align:center;">Sudoku Solver</h1>

  <div style="max-width:600px; margin:1em auto; padding:0.5em; border:1px solid #ccc; border-radius:8px; background:#f9f9f9; font-size:0.9em;">
    <h3>How to use this Sudoku solver</h3>
    <ul>
      <li>Click in a cell and type a number (1–9) to enter your puzzle. Leave cells empty for blanks.</li>
      <li>When finished, press <b>Solve</b>. The solver will fill in the missing numbers.</li>
      <li>After solving, the button changes to <b>Input</b> so you can start a new puzzle.</li>
      <li>Use the browser refresh button at any time to reset everything.</li>
    </ul>
  </div>


  <table id="sudoku">
    <!-- 9×9 grid -->
    <tbody>
      <!-- Generate 9 rows with 9 inputs -->
      <script>
        for (let r = 0; r < 9; r++) {
          document.write("<tr>");
          for (let c = 0; c < 9; c++) {
            document.write("<td><input maxlength='1'></td>");
          }
          document.write("</tr>");
        }
      </script>
    </tbody>
  </table>

  <button id="solveBtn">Solve</button>

  <script src="sudoku.js"></script>
  <script>
    let solveSudoku;

    // Wait for WASM runtime to load
    Module.onRuntimeInitialized = () => {
      solveSudoku = Module.cwrap('solveSudoku', 'number', ['string', 'number']);
    };

    const btn = document.getElementById("solveBtn");
    const table = document.getElementById("sudoku");

    btn.addEventListener("click", () => {
      if (btn.innerText === "Solve") {
        const puzzle = readPuzzle();
        const solution = callSolver(puzzle);

        if (solution) {
          fillPuzzle(solution);
          btn.innerText = "Input New";
        } else {
          alert("No solution found.");
        }
      } else {
        clearPuzzle();
        btn.innerText = "Solve";
      }
    });

    function readPuzzle() {
      let str = "";
      const inputs = table.querySelectorAll("input");
      inputs.forEach(inp => {
        const val = inp.value.trim();
        str += val.match(/[1-9]/) ? val : ".";
      });
      return str;
    }

    function callSolver(puzzle) {
      const outPtr = Module._malloc(82);
      const ok = solveSudoku(puzzle, outPtr);
      let result = null;
      if (ok) result = Module.UTF8ToString(outPtr);
      Module._free(outPtr);
      return result;
    }

    function fillPuzzle(solution) {
      const inputs = table.querySelectorAll("input");
      for (let i = 0; i < 81; i++) {
        inputs[i].value = solution[i];
      }
    }

    function clearPuzzle() {
      const inputs = table.querySelectorAll("input");
      inputs.forEach(inp => inp.value = "");
    }
  </script>
</body>
</html>
